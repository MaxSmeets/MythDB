{% extends "base.html" %}

{% block title %}MythDB Â· {{ project.name }} Â· {{ article.title }}{% endblock %}

{% block content %}
<div class="article-layout">
  <aside class="sidebar" aria-label="Article metadata">
    <div class="card">
      <h3 class="card-title">Metadata</h3>
      <p class="card-meta"><strong>ID:</strong> {{ article.id }}</p>
      <p class="card-meta"><strong>Slug:</strong> {{ article.slug }}</p>
      <p class="card-meta"><strong>Created:</strong> {{ article.created_at }}</p>
      <p class="card-meta"><strong>Updated:</strong> {{ article.updated_at }}</p>
    </div>

    <div class="card">
      <h3 class="card-title">Structured fields</h3>
      <p class="card-meta muted">Coming next (field definitions + values).</p>
    </div>
  </aside>

  <div class="article-main">
    <header class="page-header">
      <p class="breadcrumb">
        <a href="{{ url_for('projects.projects_overview') }}">Projects</a>
        <span aria-hidden="true">/</span>
        <a href="{{ url_for('projects.project_home', slug=project.slug) }}">{{ project.name }}</a>
        <span aria-hidden="true">/</span>
        <span>{{ article.title }}</span>
      </p>

      <div class="article-header-row">
        <div>
          <h2>{{ article.title }}</h2>
          <p class="muted">
            <strong>Type:</strong> {{ article.type_name }}
            <span aria-hidden="true">Â·</span>
            <strong>Slug:</strong> <code>{{ article.slug }}</code>
          </p>
        </div>
        <button id="modeToggle" class="btn" data-mode="read">âœï¸ Edit</button>
      </div>
    </header>

    <!-- Read mode -->
    <article id="readMode" class="article-body markdown" aria-label="Article body">
      {{ rendered_html | safe }}
    </article>

    <!-- Edit mode -->
    <form id="editMode" method="post" action="{{ url_for('articles.edit_article', slug=project.slug, article_id=article.id) }}" class="article-editor hidden">
      <textarea 
        name="body_content" 
        class="editor-textarea" 
        required 
        placeholder="Write your markdown here..."
        spellcheck="false"
      >{{ article.body_content }}</textarea>

      <div class="editor-actions">
        <button type="submit" class="btn">ğŸ’¾ Save</button>
        <button type="button" id="cancelEdit" class="btn btn-secondary">Cancel</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const modeToggle = document.getElementById('modeToggle');
  const readMode = document.getElementById('readMode');
  const editMode = document.getElementById('editMode');
  const cancelEdit = document.getElementById('cancelEdit');
  
  let currentMode = 'read';

  modeToggle.addEventListener('click', () => {
    if (currentMode === 'read') {
      // Switch to edit
      readMode.classList.add('hidden');
      editMode.classList.remove('hidden');
      modeToggle.textContent = 'ğŸ‘ï¸ View';
      modeToggle.dataset.mode = 'edit';
      currentMode = 'edit';
      editMode.querySelector('textarea').focus();
    } else {
      // Switch to read
      readMode.classList.remove('hidden');
      editMode.classList.add('hidden');
      modeToggle.textContent = 'âœï¸ Edit';
      modeToggle.dataset.mode = 'read';
      currentMode = 'read';
    }
  });

  cancelEdit.addEventListener('click', () => {
    // Reset textarea to original content
    const textarea = editMode.querySelector('textarea');
    textarea.value = textarea.defaultValue;
    // Switch back to read mode
    modeToggle.click();
  });
</script>
{% endblock %}
